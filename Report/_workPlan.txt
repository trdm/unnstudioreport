http://docs.google.com/Doc?docid=0AScPGlzX52sqZGZndDM2cTdfN3RoZzJxZGZm&hl=ru
[version - 1.0]
* [ок] Реализовать прямой ввод в текста ячейку.
* [ок] Реализовать механизм регулирования высоты строки в зависимости от её текста и свойств переноса.
* [ок] реализовать считывание документа из xml.
* [ок] реализовать авто-размер поля ввода текста ячейки.
* [ок] Перекалькуляция размеров РЕГИОНОВ СЕКЦИЙ.
* [ок] доделать: class uoSpanScaner01 : public uoSpanTreeScan
* [ок/2]Реализовать механизм печати текста по соседним ячейкам, если он не помещается в одной и соседние ячейки пусты.
* [ок/2] Реализовать отрисовку и редактирование секций.
* [ок] При выделении ячейки с пом. мышки необходимо устанавливать текущую ячейку ту, над которой кончилось выделение.
* [ок/2] Нужно на всякий пожарный так же добавить определение private конструктора
	копирования и оператора копирующего присваивания, чтобы невозможно было случайно контрол скопировать.
* [ok] В механизме Ундо-редо продумать+сделать апдейтинг полотна отчета.
* [ok] Диалог свойств плохо реагирует на Cansel.
* [ok] Отрисовка рамок и работа со свойствами рамок.
* [ok] populatePropEditor(uoReportPropEditor* propEditor) <<< имплементировать.
* [ok] Реализовать отрисовку и заполнение свойств бордюров.
* [ok/99] Доделать fonf-dialog в палитре свойств. (цвет недоделан.)
* [ok/99] поработать со скролом. 1) Странное поведение линейки прокрутки, если я просто щёлкаю по ячейкам, всё ниже и ниже, линейка прокрутки уменьшается в размерах, хотя я ещё не вышел за поля.
* [ok] Перенести возможность загрузки текстового файла из main.cpp в код документа, добавить опцию в меню и
* [ok] сделать индикатор загрузки....
* [ok] добавить опцию: создание матрицы
* [ok] - сделать в лоадере считывание матриц....
* [ok/2]Копирование/вставка/драг-дроп.
* [ok/2]- uorMimeData + надо составить план и его держаться....
* [ok]-- Сериализация (документа|части документа) в QTextSteam->QByteArray, c спом. селекшиона.
* [ok] Баг!!!!!!!!!!! не копируется с выделением uoRst_Unknown = фактически это ячейка.
* [ok] (не могу поймать) бага - при вставке/удалении первых столбцов/строк не прорисовывается правая/нижняя часть листа. (форматирование косячило.)
* [ok] сделать виджет, отображающий:
* [ok]	- окно адреса текущей ячейки;
* [ok]	- окно поиска текста;
* [ok] uoUsePictureForCell - надо перенести в документ
* [ok] Сделать нормальное выделение при объединении мышкой в динамике при перемещении указателя мыши.
2016-11-12
* [ok] бага: при обновлении отчета теряется форматирование шрифта, открывает простой отчет где ячейка 1:1 заполнена надписью "Привет!" и отформатирована жирным шрифтом
	Однако отображается обыкновенным шрифтом, пока не добавшь что-то в отчет. Потом нормально, убираешь и снова простой шрифт.
* Реализовать маштабирование в предпросмотре. Сделал, но качество похабное.
	надо воспользоваться установкой uoReportCtrl::m_scaleFactor
* Перевести редактирование свойсв отчета на проперти-виджет.
* Добавить сложный контрол: комбобокс, трансформирующийся в итембокс.
* Реализовать поиск в отчете.
* Кнопки и пункты меню Акселераторы:
*	Шрифт(Жирный: Ctrl+B; Италик: Ctrl+I, Подчеркнутый: Ctrl+U )
*	Размер шрифта: (Увеличение: Ctrl+Shift+"+"; Увеличение: Ctrl+Shift+"-")
*	Масштаб: (Увеличение: Ctrl+"+"; Увеличение: Ctrl+"-")
* Отрисовка групп крайне похабная.
- вывод на печать:
* 	[ok] uoPreviewDlg.ui >> uoReportPreviewDlg.ui
* 	Диалог предпросмотра добавить масштабирование
*		[ok] -диапазоны страниц,
*		[ok/2] -подгон под ширину листа.
* 		- подгон при каком-то маленьком масштабе падает.
* Сделать выделение ячейки кликом. Сейчас выделяется только несколько ячеек, надо сделать выделение кликом по одной ячейке.
* Сделать возможным выделять строки и столбцы с клавиатуры...
* Течет память при создании/очистки матрицы. (вроде это где-то во вьюве.)
* бага: не удаляется диапазон строк/столбцов, удаляется по одному.
* Переместить m_cellTextCashe (кешь пиксмапов) в документ.

*- QString uoCell::getTextWithLineBreak(bool drawInv)
*- тестирование class uoNumVector (удаление.)
* Объединения ячеек О_о...
*-- Думаю я неправильно сделал объединение, необходимо расчитывать его ректы при форматировании. прийдется паеределывать...
* сделать отрисовку на Win API для Windows.
* Реализовать механизм Ундо-редо.
* Реализовать графические примитивы: линию, картинку, рамку с текстом, прямоугольник. редактирование, заполнение, отрисовку.
* быстрое выделение строки/столбца, например, по сtrl+shift+up(down).
* ОПТИМИЗАЦИЯ!!!!  ПРОФАЙЛИНГГГГГ
* есть мысля по оптимизации памяти, нафига эти структуры:
	uorTextDecor* m_textProp;
	uorBorderPropBase* m_borderProp;
	можно ведь хранить идентификаторы сопоставимых конструкций, а в uoCell писать только их номер в коллекции..
* сделать выделение диапазона строк/столбцов с зажатым шифтом.
* Реализовать установку разрывов страниц в отчете.
* Реализовать работу с колонтитулами: редактирование, расчет, их вывод в отчет.
* Оптимизация: вычислить текущую ячейку и при её смене не перерисовывать полотно, а перерисовать ячейку.
* По двойному щелчку на пустую ячейку появляется делегат с виджетом-редактором как для чисел (SpinBox), а водить можно не только числа, лучше его убрать. (маленький размер поля ввода)
* Реализовать определение участка клика мышки, если он находится на выделении проработать меню..
* [ok] Баг: текст отрисовывается с m_firstVisible_ColLeft пока не наберется нужной длинны строки.	Если имеем длинные строки и проскролим вправо, то эти строки отрисовываться не будут.
* Сериализация - сделать сериализацию и восстановление свойств документа uorTextDecor и таких-же свойст хейдеров.
* Баг: неправильно расчитывается линия, показывающая изменение ширины высоты ячеек линейек, если масштаб <> 100.

* [OK] Сделать акселератор поиска для uoNumVector.
* [OK] Попробовать оптимизировать доступ к ячейкам/строкам и столбцам. Тормозит при большом масштабе.

* Додумать логику работы палитры свойств - в смысле какие атрибуты есть у:
	- Документа в целом;
	- Набора строк/столбцов.
	- ячеек и групп ячеек.
* Скомпоновать в библиотеку.
* какого хера 	uorPagePrintSetings.h >> uorNumber m_scaleFactor; ??? должен быть qreal !!!
* Не работает несколько вьювов на одном доке. - не обновляет 2-й вьюв.

============================================================================
/*
привет, Дима.
сейчас тщательней потестил.
может у тебя какие мысли появятся

вот такой код для превьюхи у меня на данный момент, всё лишнее выбросил:
https://gist.github.com/4265370

если закомменчено как написано, превьюха конечно пустая открывается.
утечки не наблюдается

если расскоментировать ( = задействовать объект doc)
то потихоньку память опять отъедает после периодического выполнения этой процедуры.
*/
void MainWin::tryUNNReport() {
uoReport::uoReportView* m_GR;
uoReport::uoReportDoc* doc;
m_GR = new uoReport::uoReportView();
doc = m_GR->getControl()->getDoc();
m_GR->getControl()->optionShow(true, true, true, true);
m_GR->getControl()->doFixedView(2,2);
m_GR->getControl()->setFocus();
doc->enableCollectChanges(true);
QString fName /*= qApp->applicationDirPath()+"/reports/vedTemplate2.xml"*/;
fName = qApp->applicationDirPath()+"/reports/reportSelection.xml";
if (QFile::exists(fName)){
// doc->setSourceDocFile(QString(fName));
// doc->setSourceDocFile(fName);
//// расскомментить
// doc->setPageOrientation(QPrinter::Landscape);
// doc->setVariable("ПечЗаголовокОтчета","РМД печать выборки");
// doc->setVariable("ПечДата", QDate::currentDate().toString("d MMMM yyyy"));
// doc->setVariable("ПечУсл", ui->lbFilterText->text());
// doc->outputSection("Caption|topCaption");
// doc->setVariable("ДатаПровер","Дата\nпроверки");
// doc->setVariable("ВремяПровер", "Время\nпроверки");
// doc->setVariable("Дефектоскопист", "Дефектоскопист");
// doc->setVariable("ЗавНомИзд", "Заводской ном. изделия");
// doc->setVariable("ТипДет", "Тип детали");
// doc->setVariable("НомДет", "Номер детали");
// doc->setVariable("НомЗав", "Номер завода");
// doc->setVariable("ГодИзг", "Год изготовления");
// doc->setVariable("НомДеф", "Номер дефекта");
// doc->setVariable("ЗонаКонтр", "Зона контроля");
// doc->setVariable("КодДеф", "Код дефекта");
// doc->setVariable("ДлинаДеф", "Длина дефекта");
// doc->setVariable("ВеличинаСиг", "Величина сигнала");
// doc->setVariable("Заключ", "Заключение");
// doc->outputSection("TableHeader|sectionMain");
doc->updateViews();
m_GR->previewExec();
delete m_GR;
}
}
============================================================================

========Qt-Виктор (20:47:00 28/01/2010)========
Вроде как баги:
[OK] 1. Если выделить самую верхнюю строку и нажать "Строки/Столбцы -> Вставить", то весь текст (кроме первого столбца) пропадает.
[OK] 2. При изменении масштаба глюки. Поверх нового отрисовывается старый масштаб (причём если на новом, к примеру 125% влезло 24 строки, то старый отрисовывается на 24 строки).
[OK] 3. Иногда (не заметил в при каких условиях), после сохранения пропадает текст первой строки.
[OK] 4. Если написать текст в ячейку больше её ширины (когда текст не влазиет), то он режется. Стоит только нажать "Свойства" на ячейки и нажать "Update" и он сразу начинает залазить и на другие ячейки.
[OK] 5. "Вырезать" не работает.

Фичи:
1. Чтобы сделать жирную линию нужно у ячейки, скажем cell[iCell, iRow], сделать рамку (Bottom border) вида "-----", а у нижней Cell[iCell, iRow + 1] вида "=====". тогда они наложатся и получится очень жирная линия (рамка).

P.S. Когда компилю в студии (что я обычно и делаю  ) вылазиет куда варнингов.

Предложения:
1. С помощью клавиши Ctrls можно выделить разные ячейки, но нельзя отменить выделение выделенной ячейки.


[version - 2.0]
* нужен внутренний, более компактный формат сериализации.
* -- Драг-дроп доделать.. а может ну его нафиг? :(
* (отложил) Реализовать фиксацию областей просмотра отчета.	(определить данные областей.
* !Не буду делать пока свойства текста для строк и столбцов. А прийдется :((((((((((((

реализовать такую идею: SQL запросы к прямоугольным областям отчета.


Qt-Виктор (19:19:44 23/01/2010)
у Вас есть такой файлик uoReportDrawHelper.cpp, там есть void uoReportDrawHelper::drawCell
          if (uoCTT_Templ == textTp )     {
               text = "{" + text + "}";
               addChrs = addChrs + "{}";
          } else if (uoCTT_Expr  == textTp) {
               //////////////////////////////////////////////////////////////////////////
               const int iAccuracy = 4;


				text.replace(" ", "").replace("\n", "").replace("\t", "");
               if(text.at(0) != QChar('=')){
                    text = text;
               }else{
                    for(int iC = 1; iC <= doc->getColCount(); iC ++){
                         for(int iR = 1; iR <= doc->getRowCount(); iR ++){
                              // SUM RegExp
                              if(text.contains(QString("[%1:%2]").arg(iC).arg(iR), Qt::CaseSensitive)){
                                   double dValue = doc->getCellText(iR, iC).toDouble();
                                   dValue = dValue < 0 ? 0 : dValue;
                                   text.replace(QString("[%1:%2]").arg(iC).arg(iR), QString::number(dValue));
                              }
                         }
                    }
                    text.replace("=", "");
                    text = QScriptEngine().evaluate(text).toString().replace(".", ",");
                    if(text.contains("Error")){
                         text = "@Error";
                    }else{
                         double dValue = text.toDouble();
                         text = QString().setNum(dValue, 'f', iAccuracy);
                    }
               }
               //////////////////////////////////////////////////////////////////////////
               addChrs = addChrs + "<>";
          }
		  //и считаются люьые формулы )
		  //Маньяк ))))))

стукни в асю когда закончишь.
надо перепроведение запустить.


///\todo посмотреть: QTextItem/QTextItemInt
